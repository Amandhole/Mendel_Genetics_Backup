{% extends "admin/admin_base.html" %}
{% load static %}
{% block content %}



<!-- Mirrored from pixner.net/sbidu/main/profile.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Aug 2022 06:34:10 GMT -->



<style type="text/css">
    #menu {
  /*background: #343434;*/
  color: #eee;
  height: 35px;
  /*border-bottom: 4px solid #eeeded*/
}

#menu ul,
#menu li {
  margin: 0 0;
  padding: 0 0;
  list-style: none
}

#menu ul {
  height: 35px
}

#menu li {
  /*float: left;*/
  /*display: inline;*/
  position: relative;
  /*font: bold 12px Arial;*/
  /*text-shadow: 0 -1px 0 #000;*/
  /*border-right: 1px solid #444;*/
  /*border-left: 1px solid #111;*/
  /*text-transform: uppercase;*/
}

#menu li:first-child {
  border-left: none
}

#menu a {
  display: block;
  line-height: 35px;
  padding: 0 14px;
  text-decoration: none;
  color: #eee;
}

#menu li:hover > a,
#menu li a:hover {
  background: #002947;
}

#menu input {
  display: none;
  margin: 0 0;
  padding: 0 0;
  width: 80px;
  height: 35px;
  opacity: 0;
  cursor: pointer
}

#menu label {
  font: bold 30px Arial;
  display: none;
  width: 35px;
  height: 36px;
  line-height: 36px;
  text-align: center
}

#menu label span {
  font-size: 12px;
  position: absolute;
  left: 35px
}

#menu ul.menus {
  height: auto;
  width: 290px;
  background: #002947;;
  position: absolute;
  z-index: 99;
  display: none;
  border: 0;
}

#menu ul.menus li {
  display: block;
  width: 100%;
  font: 12px Arial;
  text-transform: none;
}

#menu li:hover ul.menus {
  display: block
}

#menu a.home {
  background: #c00;
}

#menu a.prett {
  padding: 0 27px 0 14px
}

#menu a.prett::after {
  content: "";
  width: 0;
  height: 0;
  border-width: 6px 5px;
  border-style: solid;
  border-color: #eee transparent transparent transparent;
  position: absolute;
  top: 15px;
  right: 9px
}

#menu ul.menus a:hover {
  background: #333;
}

#menu ul.menus .submenu {
  display: none;
  position: absolute;
  left: 180px;
  background: #111;
  top: 0;
  width: 180px;
}

#menu ul.menus .submenu li {
  background: #111;
}

#menu ul.menus .has-submenu:hover .submenu {
  display: block;
}
.login-form .form-group input {
  padding: 0px 15px !important;
}

.action-btn{
  width: auto;
  height: 40px;
  border-radius:
  5px;background-color: #683df5;
  border: none;
}
</style>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">


<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />

<link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">


<!-- Select2 CSS --> 




<body>
   <input type="hidden"  value="{{user_obj.id}}" name="" id="user_id">
    <!--============= ScrollToTop Section Starts Here =============-->
    {% comment %} <div class="overlayer" id="overlayer">
        <div class="loader">
            <div class="loader-inner"></div>
        </div>
    </div>
    <a href="#0" class="scrollToTop"><i class="fas fa-angle-up"></i></a>
    <div class="overlay"></div> {% endcomment %}
    <!--============= ScrollToTop Section Ends Here =============-->



    <!--============= Header Section Starts Here =============-->

    <!--============= Header Section Ends Here =============-->

    <!--============= Cart Section Starts Here =============-->
    <div class="cart-sidebar-area">
        <div class="top-content">
            
            <span class="side-sidebar-close-btn"><i class="fas fa-times"></i></span>
        </div>
        <div class="bottom-content">
            <div class="cart-products">
                
                
                <ul id="menu" style="color: white;">
                    
                        <li><a class='prett' href='#' title='Menu'>About Us</a>
      <ul class='menus'>
        
        <li><a href='#' title='Dropdown 2'>About Mendel Genetics</a></li>
        <li><a href='#' title='Dropdown 3'>Mission, Vision and Values</a></li>
        <li><a href='#' title='Dropdown 3'>Management Team</a></li>
        <li><a href='#' title='Dropdown 3'>Institutional Relationships</a></li>
        <li><a href='#' title='Dropdown 3'>Quality</a></li>
      </ul>
    </li>

                        <li><a class='prett' href='#' title='Menu'>Diagnostic fields</a>
      <ul class='menus'>
        
        <li><a href='#' title='Dropdown 2'>Genome Sequencing</a></li>
        <li><a href='#' title='Dropdown 3'>Liquid Biopsy</a></li>
        <li><a href='#' title='Dropdown 3'>Molecular Oncology</a></li>
        <li><a href='#' title='Dropdown 3'>NGS Panels</a></li>
        <li><a href='#' title='Dropdown 3'>Exome</a></li>
      </ul>
    </li>

                
                    <li><a href="" style="color: #fff;">Precision Medicine</a></li>
                    <li><a href="" style="color: #fff;">Genetic Counselling</a></li>
                    <li><a href="" style="color: #fff;">Ordering a test</a></li>
                    <li><a href="" style="color: #fff;">News and Events</a></li>
                    <li><a href="" style="color: #fff;">Contact</a></li>
                </ul>
                
                
                
                
                <!-- <div class="btn-wrapper text-center">
                    <a href="#0" class="custom-button"><span>Checkout</span></a>
                </div> -->
            </div>
        </div>
    </div>
    <!--============= Cart Section Ends Here =============-->

    <!--============= Hero Section Starts Here =============-->
    <div class="hero-section style-2">
        <div class="container">
        
        </div>
        <div class="bg_img hero-bg bottom_center" data-background="{% static 'assets/images/banner/hero-bg.png' %}"></div>
    </div>
    <!--============= Hero Section Ends Here =============-->


    <!--============= Dashboard Section Starts Here =============-->
    <section class="dashboard-section padding-bottom mt--240 mt-lg--440 pos-rel">
        <div class="container">
            <div class="row justify-content-center">

              {% comment %} {%  include  'admin/sidebar.html' %} {% endcomment %}

                <div class="col-lg-12">
                    <div class="row">
                        <div class="col-10">
                            <div class="dash-pro-item mb-30 dashboard-widget" style="width:1200px; max-height:1450px;">
                                
                                <div style="margin-top: 25px;">
                                    <center> <h6>Result Uploaded Test</h6></center>
                                    <hr>
                                </div>
                                {% comment %} div for pending test {% endcomment %}
                                

                                <div class="row float-right" style="padding-bottom: 20px;">
                                    {% comment %} <div class="col-auto" style="padding-right: 0px;">
                                      <button class="btn-primary action-btn" style="background-color: #3CB371;" onclick="approve_test_from_user()">Approve <i class="fas fa-thumbs-up"></i></button>
                                    </div> {% endcomment %}

                                    {% comment %} <div class="col-auto" style="padding-right: 0px;">
                                      <button class="btn-primary action-btn" style="background-color: #FF0000;">Reject <i class="fas fa-thumbs-down"></i></button>
                                    </div> {% endcomment %}

                                    <div class="col-auto">
                              
                                       <select id="select_test" style="height: 40px;border-radius:5px;background-color: #683df5;color: white;" onchange="window.location.href=this.value;">

                                        
                                        <option value="{% url 'uploaded_result_test' %}">Result Upload</option>
                                        <option value="{% url 'published_test' %}">Published</option>  
                                        <option value="{% url 'pending_test' %}">Pending</option>
                                          

                                      </select> 
                                    </div>
                                </div> 


                                <div id="div_pending_test">
                                  
                                  
                                  <table id="pennding_table_id" class="table table-striped table-bordered" style="width:100%">
                            
                                    {% comment %} <button type="button" style="    width: 130px;margin-left: 500px;" class="btn btn-primary">Filter</button>  {% endcomment %}
                                
                                      <thead>
                                        <tr>
                                        {% comment %} <td><input claas="checkbox"  type="checkbox" name="" id="select_all" style="width: 30px;margin-left: 8px;"><p style="font-weight: 600;"></p></td> {% endcomment %}
                                          <th>Sr No</th>
                                          <th>Lot Id</th>
                                          <th>Auction Date</th>
                                          <th>Auctioner</th>
                                          <th>Bidder</th>
                                          <th>Result date</th>
                                          <th>Doc 1</th>
                                          <th>Doc 2</th>
                                          <th>Action</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        {% for test in uploaded_result_obj %}
                                        <tr>
                                            {% comment %} <td>
                                                <input style="margin-left: 8px;width: 30px;" type="checkbox" class="checkbox" name="checkbox" id="checkboxid" value={{i.id}} data-id={{i.fk_user.id}}> 
                                            </td> {% endcomment %}
                                            <td>{{forloop.counter}}</td>

                                            

                                            {% if test.test_lot_id %}
                                                <td>{{test.test_lot_id}}</td>
                                            {% else %}
                                                <td>----</td>
                                            {% endif %}


                                            {% if test.created_date_time %}
                                                <td>{{test.created_date_time}}</td>
                                            {% else %}
                                                <td>----</td>
                                            {% endif %}    


                                            {% if test.fk_user_master.name %}
                                                <td>{{test.fk_user_master.name}}</td>
                                            {% else %}
                                                <td>----</td>
                                            {% endif %}   

                                            {% if test.fsdf %}
                                                <td>{{test.test_quantity}}</td>
                                            {% else %}
                                                <td>----</td>
                                            {% endif %}       

                                            {% if test.upload_date_time %}
                                                <td>{{test.upload_date_time}}</td>
                                            {% else %}
                                                <td>----</td>
                                            {% endif %}

                                            <td>---</td>
                                            {% comment %} {% if test.bidder_doc_first %}
                                                <td><button type="button" onclick="download_document()" style="background-color: green;color: white;height: 29px;width: 58px; border-radius: 5px; border: none; margin-left: 2px;">
                                                  <i class="fa fa-download"></i> 
                                                </button></td>
                                            {% else %}
                                                <td>No Doc</td>
                                            {% endif %} {% endcomment %}

                                            <td>---</td>
                                            {% comment %} {% if test.bidder_doc_second %}
                                                <td><button type="button"  onclick="download_document()" style="background-color: green;color: white;height: 29px;width: 58px; border-radius: 5px; border: none; margin-left: 2px;">
                                                  <i class="fa fa-download"></i> 
                                                </button></td>
                                            {% else %}
                                                <td>No Doc</td>
                                            {% endif %} {% endcomment %}

                                            <td>
                                                ---
                                                {% comment %} {% if test.result_upload_status == "Upload" %}
                                                    <button type="button" data-toggle="modal" data-target="#upload_result_modal" onclick="append_lot_id()" style="background-color: #00b7eb;color: white;height: 29px;width: 58px; border-radius: 5px; border: none; margin-left: 2px;">
                                                      <i class="fa fa-upload"></i> 
                                                    </button>
                                                {% else %}

                                                    <span class="badge badge-primary" style=" font-size: 13px; padding: 8px 15px 8px 15px; background-color: #7600bc;margin-left: 45px;">
                                                        uploaded
                                                    </span>
                                                {% endif %}      {% endcomment %}
                                            </td> 
                                          </tr>
                                        {% endfor %}

                                      </tbody>
                                  </table>
                                </div>
                            
                            </div>    
                        </div>       
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Button trigger modal -->


    

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Edit</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-left: 361px;">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
                    <div class="login-form">
                        <div class="form-group mb-30">
                            <label for="login-email"><i class="far fa-envelope"></i></label>
                            <input type="text" id="login-email" placeholder="Email Address">
                        </div>
                        <div class="form-group">
                            <label for="login-pass"><i class="fas fa-lock"></i></label>
                            <input type="password" id="login-pass" placeholder="Password">
                            <span class="pass-type"><i class="fas fa-eye"></i></span>
                        </div>
                        <div class="row" style="justify-content:center;">
                            <div class="col-md-6">
                                <div class="form-group mb-0">
                            <button type="submit" class="custom-button" style="font-size: 15px;">Save Changes</button>
                        </div>
                            </div>
                            <div class="col-md-5">
                               <div class="form-group mb-0">
                            <button type="submit" class="custom-button">Close</button>
                        </div> 
                            </div>
                        </div>
                        
                        
                    </div>
      </div>

    </div>
  </div>
</div>


<div class="modal fade" id="upload_result_modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="max-width: 700px !important;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>

                <div class="" style="justify-content:center;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="justify-content: center;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>


            </div>

            <input type="hidden" id="test_id">

            <div class="modal-body">

                                   
                <div class="login-form">
                
                    <div>
                        <h6 style="text-align: center;">Upload Documents</h6><hr><br>
                    </div>
                

                    {% comment %} <label class="flot-center" for="title">Select Files</label><br> {% endcomment %}
                          
                    <div class="col-md-12 row">

                        <div class="col-md-6">
                            <div class="">
                                <input accept="image/*" class="inpcls" id="first_file" required type="file"><br>

                                    {% if meal_data.meal_image %}
                                        <img alt="Image" id="target_img_first" src="{{meal_data.meal_image.url}}" style="border:1px solid #b2b2b2;width: 40%;height: 122px;margin-bottom:10px;margin-top: 5px;">
                                    {% else %}
                                        <img alt="Image" id="target_img_first" src="{% static 'assets/images/dashboard/user-profile-pic-upload.png' %}" alt="user" style="border:1px solid #b2b2b2;height: 122px;margin-bottom:10px;margin-top: 5px;">
                                    {% endif %}
                                        {% comment %} <i class="fas fa-trash-alt" onclick="Remove_Image('{{meal_data.id}}')" style="cursor:pointer;"></i> {% endcomment %}
                               
                                    <span class="focus-input100"></span><br>
                                    

                            </div>
                        </div>
                        
                        


                        <div class="col-md-6">
                            <div class="">
                                <input accept="image/*" class="input100" id="second_file" required type="file"><br>

                                    {% if meal_data.meal_image %}

                                        <img alt="Image" id="target_img_second" src="{{meal_data.meal_image.url}}" style="border:1px solid #b2b2b2;width: 40%;height: 122px;margin-bottom:10px;margin-top: 5px;">
                                    {% else %}
                                        <img alt="Image" id="target_img_second" src="{% static 'assets/images/dashboard/user-profile-pic-upload.png' %}" alt="user" style="border:1px solid #b2b2b2;height: 122px;margin-bottom:10px;margin-top: 5px;">
                                    {%endif%}
                            
                                    {% comment %} <i class="fas fa-trash-alt" onclick="Remove_Image('{{meal_data.id}}')" style="cursor:pointer;"></i> {% endcomment %}
                                    <span class="focus-input100"></span><br>
                               
                                    <span id="error_second_file" style="color:#ff4c4ce8;font-size: 14px;"></span>
                            </div>
                        </div>

                        <span id="error_first_file" style="color:#ff4c4ce8;font-size: 14px;margin-left: 12rem;"></span>
                    </div>
                </div>

                                                    
                                 
    
                <div class="row" style="justify-content:center; margin-top: 50px;">
        
                    <div class="form-group mb-0">
                        <button type="button" id="" onclick="upload_result()" class="custom-button"  style="font-size: 16px;width:7rem; height: 45px; padding-left: 5px;padding-right: 5px;">Upload</button>
                    </div> 
    
                </div>                        
            </div>
      </div>

        </div>
    </div>
</div>

    <!--============= Dashboard Section Ends Here =============-->
    <script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js" integrity="sha512-2ImtlRlf2VVmiGZsjm9bEyhjGW4dU7B6TNwh/hx/iSByxNENtj3WVE6o/9Lj4TJeVXPi4bnOIMXFIJJAeufa0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   
   
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
 
    <script src="https://cdn.datatables.net/1.10.8/js/jquery.dataTables.min.js" defer="defer"></script>
    <script src="assets/resource/tiny_mce.js"></script>
  
<script>
    
    function readURL(input) {
        if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('#target_img_first').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
        }
    }


    function readURL_second_image(input) {
        if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('#target_img_second').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
        }
    }


    var file_size1 = 0;

    $("#target_img_first").hide()
        
		$('#first_file').bind('change', function () 
		{

			$('#error_first_file').html('');

			file_size1 = this.files[0].size;

			var i = $('.custom-file-upload').clone();
			var file1 = $('#first_file')[0].files[0].name;


            if(file_size1 > 2000000){
                console.log('file greater than 2 mb')
                $("#target_img_first").hide()
                $('#error_first_file').text('File must be less than 2mb...');
            }
            else{
                readURL(this);
                $("#target_img_first").show()
    
            }

	});


{% comment %} javascipt code for second file {% endcomment %}

    $("#target_img_second").hide()
        file_size1 = 0;
		$('#second_file').bind('change', function () 
		{

			$('#error_first_file').html('');

			file_size1 = this.files[0].size;

			var i = $('.custom-file-upload').clone();
			var file1 = $('#second_file')[0].files[0].name;


            if(file_size1 > 2000000){
                console.log('file greater than 2 mb')
                $("#target_img_second").hide()
                $('#error_first_file').text('File must be less than 2mb...');
            }
            else{
                readURL_second_image(this);
                $("#target_img_second").show()
    
            }

	});



    
function append_lot_id(){
    alert('hello')
    $("#bid_test_id").val(id)
}

function upload_result_by_admin() {

    var bid_test_id = $("#bid_test_id").val()
   
    var first_documet = $('#first_file').val();
    var second_documet = $('#second_file').val();


    if ((first_documet == "") && (second_documet == "") ) {

        $('#error_first_file').html('Please Select atleast one file');
    }
    

    else if(file_size1 > 2000000){
        $('#error_first_file').text('File must be less than 2mb...');
    }

    
    else{
        var item_data = new FormData();
        var first_documet = $('#first_file')[0].files;
        var second_documet = $('#second_file')[0].files;
        

        item_data.append('first_documet', first_documet[0]);
        item_data.append('second_documet', second_documet[0]);
        item_data.append('bid_test_id', bid_test_id);
        
        $.ajax({
            method: "POST",
            url: "{% url 'upload_result_by_admin' %}",
            enctype: "mutipart/form_data",
            processData: false,
            contentType: false,
            cache: false,
            data: item_data,
            success: function (response) {
                if (response['status'] == "1"){
                    swal({
                        icon:"success",
                        text:"Result Uploaded Succesfully",
                        closeOnClickOutside:false
                    }).then(function(){
                        location.reload()
                    })
                }
                else if (response['status'] == "0"){
                    swal({
                        icon:"error",
                        text:"Something wennt wrong",
                        closeOnClickOutside:false
                    })
                }
            }
        });
    }
}

</script>

<script>

    $(document).ready(function(){
      $("#id_test").addClass('newclass')
      $("#select_gens_id").hide()
      $("#show_hide_data").hide() 

      //hide show data table
      $("#div_for_published_test").hide()

      // data table section
      $('#pennding_table_id').DataTable();
      $('#published_table_id').DataTable();
    
    })

</script>



</script>

<script>

   function upload_result_by_admin(id){
        console.log(id)
        swal({
            icon:"warning",
            text:"Are you sure to upload result?",
            buttons: ["No", "Yes"],
            dangerMode: true,
            closeOnClickOutside:false                    
        }).then((willUpdate) => {
            if(willUpdate){
                $.ajax({
                    method:"POST",
                    url:"{% url 'upload_result_by_admin' %}",
                    contentType:"application/json",
                    data:JSON.stringify({
                        "test_lot_id":id
                    }),
                    success:function(response){
                        if(response['status']== '1'){
                            swal({
                                icon:"success",
                                text:"Result has been published Successfully",
                                closeOnClickOutside:false
                            }).then(function(){
                                location.reload()
                            })
                        }
                        else if(response['status'] == '0'){
                            swal({
                                icon:"error",
                                text:"Something Went wrong",
                                closeOnClickOutside:false
                            })
                        }
                    }
                })
            }
        })
        
   } 



   
   function approve_test_from_user()
   {
      var test_id=[]
      var lot_for_user = []
    
      $("input:checkbox[name='checkbox']:checked").each(function(){
          var user_id = $(this).attr("data-id"); 

          if (lot_for_user.find( lot_for_user => lot_for_user['user_id'] === user_id))
          {
            var array_obj = lot_for_user.find( lot_for_user => lot_for_user['user_id'] === user_id);
            array_obj.lot_tests.push($(this).val());
          }
          else
          {
            lot_for_user.push({'user_id':user_id, 'lot_tests':[$(this).val()]})
          }
                      
          
        });

        console.log(lot_for_user);
        //console.log('user_id',user_id)
        
    
        swal({
            icon:"warning",
            text:"Are you sure to publish test?",
            buttons: ["No", "Yes"],
            dangerMode:false,
            closeOnClickOutside:false                    
        }).then((willUpdate) => {
          if(willUpdate){
          $.ajax({
          method:"Post",
          url:"{% url 'get_lot_of_test_from_admin' %}",
          contentType:"application/json",
          data:JSON.stringify({
            "testlot":(lot_for_user)
          }),
          success: function(response){
            if (response['status'] == '1'){
              location.reload();
            }
            else if (response['status'] == '0'){
              swal({
              icon:"error",
              text:"Something Went Wrong",
              closeOnClickOutside:false                    
        })
            }
          }
        })
          }
        })
    }

    function download_document(){
      alert('donwload doc')
    }
</script>



<script>
    $(document).ready(function(){
      
        $('#select_all').on('click',function(){
            if(this.checked){
                $('.checkbox').each(function(){
                    this.checked = true;
                });
            }else{
                $('.checkbox').each(function(){
                    this.checked = false;
                });
            }
        });
        
        $('.checkbox').on('click',function(){
            if($('.checkbox:checked').length == $('.checkbox').length){
                $('#select_all').prop('checked',true);
            }else{
                $('#select_all').prop('checked',false);
            }
        });
    });
</script>


   {% endblock %}


   


   


   