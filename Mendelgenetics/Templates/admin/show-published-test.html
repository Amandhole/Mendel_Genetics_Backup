{% extends "admin/admin_base.html" %}
{% load static %}
{% block content %}



<!-- Mirrored from pixner.net/sbidu/main/profile.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 09 Aug 2022 06:34:10 GMT -->



<style type="text/css">
    #menu {
  /*background: #343434;*/
  color: #eee;
  height: 35px;
  /*border-bottom: 4px solid #eeeded*/
}

#menu ul,
#menu li {
  margin: 0 0;
  padding: 0 0;
  list-style: none
}

#menu ul {
  height: 35px
}

#menu li {
  /*float: left;*/
  /*display: inline;*/
  position: relative;
  /*font: bold 12px Arial;*/
  /*text-shadow: 0 -1px 0 #000;*/
  /*border-right: 1px solid #444;*/
  /*border-left: 1px solid #111;*/
  /*text-transform: uppercase;*/
}

#menu li:first-child {
  border-left: none
}

#menu a {
  display: block;
  line-height: 35px;
  padding: 0 14px;
  text-decoration: none;
  color: #eee;
}

#menu li:hover > a,
#menu li a:hover {
  background: #002947;
}

#menu input {
  display: none;
  margin: 0 0;
  padding: 0 0;
  width: 80px;
  height: 35px;
  opacity: 0;
  cursor: pointer
}

#menu label {
  font: bold 30px Arial;
  display: none;
  width: 35px;
  height: 36px;
  line-height: 36px;
  text-align: center
}

#menu label span {
  font-size: 12px;
  position: absolute;
  left: 35px
}

#menu ul.menus {
  height: auto;
  width: 290px;
  background: #002947;;
  position: absolute;
  z-index: 99;
  display: none;
  border: 0;
}

#menu ul.menus li {
  display: block;
  width: 100%;
  font: 12px Arial;
  text-transform: none;
}

#menu li:hover ul.menus {
  display: block
}

#menu a.home {
  background: #c00;
}

#menu a.prett {
  padding: 0 27px 0 14px
}

#menu a.prett::after {
  content: "";
  width: 0;
  height: 0;
  border-width: 6px 5px;
  border-style: solid;
  border-color: #eee transparent transparent transparent;
  position: absolute;
  top: 15px;
  right: 9px
}

#menu ul.menus a:hover {
  background: #333;
}

#menu ul.menus .submenu {
  display: none;
  position: absolute;
  left: 180px;
  background: #111;
  top: 0;
  width: 180px;
}

#menu ul.menus .submenu li {
  background: #111;
}

#menu ul.menus .has-submenu:hover .submenu {
  display: block;
}
.login-form .form-group input {
  padding: 0px 15px !important;
}

.action-btn{
  width: auto;
  height: 40px;
  border-radius:
  5px;background-color: #683df5;
  border: none;
}
</style>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">


<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />

<link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">


<!-- Select2 CSS --> 




<body>
   <input type="hidden"  value="{{user_obj.id}}" name="" id="user_id">
    <!--============= ScrollToTop Section Starts Here =============-->
    {% comment %} <div class="overlayer" id="overlayer">
        <div class="loader">
            <div class="loader-inner"></div>
        </div>
    </div>
    <a href="#0" class="scrollToTop"><i class="fas fa-angle-up"></i></a>
    <div class="overlay"></div> {% endcomment %}
    <!--============= ScrollToTop Section Ends Here =============-->



    <!--============= Header Section Starts Here =============-->

    <!--============= Header Section Ends Here =============-->

    <!--============= Cart Section Starts Here =============-->
    <div class="cart-sidebar-area">
        <div class="top-content">
            
            <span class="side-sidebar-close-btn"><i class="fas fa-times"></i></span>
        </div>
        <div class="bottom-content">
            <div class="cart-products">
                
                
                <ul id="menu" style="color: white;">
                    
                        <li><a class='prett' href='#' title='Menu'>About Us</a>
      <ul class='menus'>
        
        <li><a href='#' title='Dropdown 2'>About Mendel Genetics</a></li>
        <li><a href='#' title='Dropdown 3'>Mission, Vision and Values</a></li>
        <li><a href='#' title='Dropdown 3'>Management Team</a></li>
        <li><a href='#' title='Dropdown 3'>Institutional Relationships</a></li>
        <li><a href='#' title='Dropdown 3'>Quality</a></li>
      </ul>
    </li>

                        <li><a class='prett' href='#' title='Menu'>Diagnostic fields</a>
      <ul class='menus'>
        
        <li><a href='#' title='Dropdown 2'>Genome Sequencing</a></li>
        <li><a href='#' title='Dropdown 3'>Liquid Biopsy</a></li>
        <li><a href='#' title='Dropdown 3'>Molecular Oncology</a></li>
        <li><a href='#' title='Dropdown 3'>NGS Panels</a></li>
        <li><a href='#' title='Dropdown 3'>Exome</a></li>
      </ul>
    </li>

                
                    <li><a href="" style="color: #fff;">Precision Medicine</a></li>
                    <li><a href="" style="color: #fff;">Genetic Counselling</a></li>
                    <li><a href="" style="color: #fff;">Ordering a test</a></li>
                    <li><a href="" style="color: #fff;">News and Events</a></li>
                    <li><a href="" style="color: #fff;">Contact</a></li>
                </ul>
                
                
                
                
                <!-- <div class="btn-wrapper text-center">
                    <a href="#0" class="custom-button"><span>Checkout</span></a>
                </div> -->
            </div>
        </div>
    </div>
    <!--============= Cart Section Ends Here =============-->

    <!--============= Hero Section Starts Here =============-->
    <div class="hero-section style-2">
        <div class="container">
        
        </div>
        <div class="bg_img hero-bg bottom_center" data-background="{% static 'assets/images/banner/hero-bg.png' %}"></div>
    </div>
    <!--============= Hero Section Ends Here =============-->


    <!--============= Dashboard Section Starts Here =============-->
    <section class="dashboard-section padding-bottom mt--240 mt-lg--440 pos-rel" id="table_section">
        <div class="container">
            <div class="row justify-content-center">

              {% comment %} {%  include  'admin/sidebar.html' %} {% endcomment %}

                <div class="col-lg-12">
                    <div class="row">
                        <div class="col-10">
                            <div class="dash-pro-item mb-30 dashboard-widget" style="width:1200px; max-height:1450px;">
                                
                                <div style="margin-top: 25px;">
                                    <center> <h6>Published Test</h6></center>
                                    <hr>
                                </div>
                                {% comment %} div for pending test {% endcomment %}
                                

                                <div class="row float-right" style="padding-bottom: 20px;">
                                    {% comment %} <div class="col-auto" style="padding-right: 0px;">
                                      <button class="btn-primary action-btn" style="background-color: #3CB371;" onclick="approve_test_from_user()">Approve <i class="fas fa-thumbs-up"></i></button>
                                    </div> {% endcomment %}

                                    {% comment %} <div class="col-auto" style="padding-right: 0px;">
                                      <button class="btn-primary action-btn" style="background-color: #FF0000;">Reject <i class="fas fa-thumbs-down"></i></button>
                                    </div> {% endcomment %}

                                    <div class="col-auto">
                              
                                       <select id="select_test" style="height: 40px;border-radius:5px;background-color: #683df5;color: white;" onchange="window.location.href=this.value;">
                                        <option value="{% url 'published_test' %}">Published Test</option>  
                                        <option value="{% url 'pending_test' %}">Pending Test</option>
                                        {% comment %} <option value="{% url 'completed_test' %}">Confirmed</option> {% endcomment %}
                                        <option value="{% url 'uploaded_result_test' %}">Completed Test</option>
                                        
                                          

                                      </select> 
                                    </div>
                                </div> 


                                <div id="div_pending_test">
                                  
                                  
                                  <table id="pennding_table_id" class="table table-striped table-bordered" style="width:100%">
                            
                                    {% comment %} <button type="button" style="    width: 130px;margin-left: 500px;" class="btn btn-primary">Filter</button>  {% endcomment %}
                                
                                      <thead>
                                        <tr>
                                        {% comment %} <td><input claas="checkbox"  type="checkbox" name="" id="select_all" style="width: 30px;margin-left: 8px;"><p style="font-weight: 600;"></p></td> {% endcomment %}
                                          <th>Sr No</th>
                                          <th>Lot Id</th>
                                          <th> Date</th>
                                          <th>Name</th>
                                          <th>Group</th>
                                          <th>Quantity</th>
                                          <th align="center" style="    text-align: center;">Action</th>
                                          {% comment %} <th>Auction</th> {% endcomment %}
                                        </tr>
                                      </thead>
                                      <tbody>
                                        {% for i in published_test_obj %}
                                        <tr>
                                            {% comment %} <td>
                                                <input style="margin-left: 8px;width: 30px;" type="checkbox" class="checkbox" name="checkbox" id="checkboxid" value={{i.id}} data-id={{i.fk_user.id}}> 
                                            </td> {% endcomment %}
                                            <td>{{forloop.counter}}</td>

                                            {% if i.test_lot_id %}
                                              <td>{{i.test_lot_id}}</td>
                                            {%else%}
                                              <td>----</td>
                                            {% endif %}   

                                           {%if i.created_date_time%}
                                            
                                              <td>{{i.created_date_time|date:'d-m-Y , g:i,a'}}</td>
                                            {%else%}
                                              <td>----</td>
                                            {% endif %}    


                                            {%if i.fk_user_master.name%}
                                              <td>{{i.fk_user_master.name}}</td>
                                            {%else%}
                                              <td>----</td>
                                            {% endif %}  
                                            
                                            
                                            {%if i.test_group%}
                                              <td>{{i.test_group}}</td>
                                            {%else%}
                                              <td>----</td>
                                            {% endif %}    

                                            {%if i.test_quantity%}
                                              <td>{{i.test_quantity}}</td>
                                            {%else%}
                                              <td>----</td>
                                            {% endif %}    
                                            
                                            <td>
                                              <button type="button"   onClick="showUserTest( {{i.id}} )" style="background-color: #6c0bff;color: white;height: 27px;width: 45px; border-radius: 5px; border: none; margin-left: 10px; margin-right: 10px;">
                                                <i class="fas fa-eye"></i>
                                            </button>   
                                            <button type="button" onClick="delete_test_by_admin( {{i.id}} )"  style="background-color: red;color: white;height: 27px;width: 45px; border-radius: 5px; border: none; margin-left: 10px; margin-right: 10px;">
                                              <i class="fas fa-trash"></i>
                                            </button> 
                                            {% if i.bid_count %}
                                              <button type="button" onclick="get_test_id_to_see_all_bids({{i.id}})" style="background-color: #7019f4;color: white;width: auto; border-radius: 5px;border: none;height: 30px;">
                                                bids  <i class="flaticon-auction"></i>
                                              </button>
                                              <span style="background-color:#ee4730;position: absolute; margin-left: -11px; margin-top: -7px;border-radius:50px; height: 15px; width: 15px;    color: white; font-size: 8px;text-align: center; line-height: 2;font-weight: 800;">{{i.bid_count}}</span>
                                            

                                          {% else %}
                                              <button type="button" onclick="get_test_id_to_see_all_bids({{i.id}})" style="background-color: #7019f4;color: white;width: auto; border-radius: 5px;border: none;height: 30px;">
                                                No Bids  <i class="flaticon-auction"></i>
                                              </button>
                                          {% endif %}
                                            </td>
                                            
                                          
                                            
                                    
                                          

   
                                            {% comment %} <td>
                                                <button type="button"  onclick="approve_test_from_user()" style="background-color: #7019f4;color: white;height: 27px;width: 45px; border-radius: 5px; border: none; margin-left: 10px; margin-right: 10px;">
                                                    <i class="fas fa-thumbs-up"></i>
                                                </button> 

                                                <button type="button" onclick="delete_test_by_admin()"  style="background-color: red;color: white;height: 27px;width: 45px; border-radius: 5px; border: none; margin-left: 10px; margin-right: 10px;">
                                                    <i class="fas fa-trash"></i>
                                                </button> 
                                            </td> {% endcomment %}
                                          </tr>
                                        {% endfor %}

                                      </tbody>
                                  </table>
                                </div> 
                            </div>    
                        </div>       
                    </div>
                </div>
            </div>
        </div>

    </section>
    <!-- Button trigger modal -->

<!-- Modal -->
<div class="modal fade" id="viewTestModal" tabindex="-1" aria-labelledby="viewTest" aria-hidden="true">
  <div class="modal-dialog modal-lg ">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Test</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-left: 34rem;">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="lot_detail"> 
        

      </div> 
    </div>
  </div> 
</div>








<section class="dashboard-section padding-bottom mt--240 mt-lg--325 pos-rel" >
        <div class="container">
            <div class="row justify-content-center">

                {% comment %} {%  include  'sidebar.html' %} {% endcomment %}


                <div id="rts_div" class="col-lg-12">

                </div>

               
 
            </div>
        </div>    
    </section>









    

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Edit</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-left: 361px;">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
                    <div class="login-form">
                        <div class="form-group mb-30">
                            <label for="login-email"><i class="far fa-envelope"></i></label>
                            <input type="text" id="login-email" placeholder="Email Address">
                        </div>
                        <div class="form-group">
                            <label for="login-pass"><i class="fas fa-lock"></i></label>
                            <input type="password" id="login-pass" placeholder="Password">
                            <span class="pass-type"><i class="fas fa-eye"></i></span>
                        </div>
                        <div class="row" style="justify-content:center;">
                            <div class="col-md-6">
                                <div class="form-group mb-0">
                            <button type="submit" class="custom-button" style="font-size: 15px;">Save Changes</button>
                        </div>
                            </div>
                            <div class="col-md-5">
                               <div class="form-group mb-0">
                            <button type="submit" class="custom-button">Close</button>
                        </div> 
                            </div>
                        </div>
                        
                        
                    </div>
      </div>

    </div>
  </div>
</div>
    <!--============= Dashboard Section Ends Here =============-->
    <script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js" integrity="sha512-2ImtlRlf2VVmiGZsjm9bEyhjGW4dU7B6TNwh/hx/iSByxNENtj3WVE6o/9Lj4TJeVXPi4bnOIMXFIJJAeufa0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   
   
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
 
    <script src="https://cdn.datatables.net/1.10.8/js/jquery.dataTables.min.js" defer="defer"></script>
    <script src="assets/resource/tiny_mce.js"></script>
  


<script>

    $(document).ready(function(){
      $("#id_test").addClass('newclass')
      $("#select_gens_id").hide()
      $("#show_hide_data").hide() 

      //hide show data table
      $("#div_for_published_test").hide()

      // data table section
      $('#pennding_table_id').DataTable();
      $('#published_table_id').DataTable();
    
    })

    function showUserTest(id){
       $.ajax({
        method : "POST",
        url : "{% url 'show_user_test' %}",
        data: {
          "lot_id" : id,
        },
        success: function(response){   
          if(response.status == '1'){
            $("#lot_detail").html(response.string ) ;
            $("#viewTestModal").modal('show');
          } 
        } 
       });
      
    } 



</script>



 

<script> 
   function delete_test_by_admin(id){
        swal({
            icon:"warning",
            text:"Are you sure to delete Lot?",
            buttons: ["No", "Yes"],
            dangerMode: true,
            closeOnClickOutside:false                    
        }).then((willDelete) => {
          if(willDelete){
            $.ajax({
              method: "POST",
              url : "{% url 'delete_user_lot' %}" ,
              data : {
                'lot_id': id,
              },
              success: function(response){ 
              if (response.status == '1'){
                swal({
                        icon:"success",
                        text:"Lot Delete Succesfully",
                        button: "OK", 
                        closeOnClickOutside:false                    
                    }).then((success)=>{
                      if(success){
                      location.reload() 
                      }
                  });
                 }
                else  {
                  swal({
                  icon:"error",
                  text:"Something Went Wrong",
                  button: "OK", 
                  closeOnClickOutside:false                    
                })
              }
            }
            })
          }
        })
   } 

   function approve_test_from_user()
   {
      var test_id=[]
      var lot_for_user = []
    
      $("input:checkbox[name='checkbox']:checked").each(function(){
          var user_id = $(this).attr("data-id"); 

          if (lot_for_user.find( lot_for_user => lot_for_user['user_id'] === user_id))
          {
            var array_obj = lot_for_user.find( lot_for_user => lot_for_user['user_id'] === user_id);
            array_obj.lot_tests.push($(this).val());
          }
          else
          {
            lot_for_user.push({'user_id':user_id, 'lot_tests':[$(this).val()]})
          }
                      
          
        });

        console.log(lot_for_user);
        //console.log('user_id',user_id)
        
    
        swal({
            icon:"warning",
            text:"Are you sure to publish test?",
            buttons: ["No", "Yes"],
            dangerMode:false,
            closeOnClickOutside:false                    
        }).then((willUpdate) => {
          if(willUpdate){
          $.ajax({
          method:"Post",
          url:"{% url 'get_lot_of_test_from_admin' %}",
          contentType:"application/json",
          data:JSON.stringify({
            "testlot":(lot_for_user)
          }),
          success: function(response){
            if (response['status'] == '1'){
              location.reload();
            }
            else if (response['status'] == '0'){
              swal({
              icon:"error",
              text:"Something Went Wrong",
              closeOnClickOutside:false                    
        })
            }
          }
        })
          }
        })
      



    }
</script>



<script>
    $(document).ready(function(){
      
        $('#select_all').on('click',function(){
            if(this.checked){
                $('.checkbox').each(function(){
                    this.checked = true;
                });
            }else{
                $('.checkbox').each(function(){
                    this.checked = false;
                });
            }
        });
        
        $('.checkbox').on('click',function(){
            if($('.checkbox:checked').length == $('.checkbox').length){
                $('#select_all').prop('checked',true);
            }else{
                $('#select_all').prop('checked',false);
            }
        });
    });




   function  get_test_id_to_see_all_bids(id){
    
    console.log(id)    
    $.ajax({
        method:"POST",
        url : "{% url 'view_all_bids_on_my_test' %}",
        contentType:"application/json",
        data: JSON.stringify({
            "test_id":id
        }),
        success:function(response){
          console.log('rts div')
          
          $("#rts_div").show();
          $("#table_section").hide()
          $("#rts_div").html(response);
           
        }

    })
} 
</script>


   {% endblock %}


   
  
  {% comment %} <span style="background-color:#ee4730;position: absolute; margin-left: -11px; margin-top: -7px;border-radius:50px; height: 15px; width: 15px;    color: white; font-size: 8px;text-align: center; line-height: 2;font-weight: 800;">{{test.bid_count}}</span> {% endcomment %}
      

   


   